# 熱盛と出てしまうBOT 仕様書 v1

## 1. 概要

本アプリケーションは、Discord サーバー内での **絵文字リアクションや Slash コマンド** をトリガーとして、
ボイスチャンネルに参加し、効果音やボイスを再生するリアクション駆動型ボイス BOT である。

ユーザー操作を最小限に抑え、「押したら鳴る」「考えなくてよい」体験を提供することを目的とする。

---

## 2. 対応プラットフォーム

* Discord
* discord.py（2.x 系を想定）
* Voice 機能（FFmpeg 使用）

---

## 3. 操作インターフェース

### 3.1 Slash コマンド

| コマンド        | 概要                            |
| ----------- | ----------------------------- |
| `/join`     | 実行者が参加中のボイスチャンネルに BOT が参加する   |
| `/leave`    | BOT が現在参加しているボイスチャンネルから退出する   |
| `/atsumori` | BOT が参加中、または自動参加後に「熱盛」音声を再生する |

※ Slash コマンドはすべて **guild 単位** で登録されることを想定する。

---

## 4. 自動ボイスチャンネル接続仕様

### 4.1 自動参加条件

以下の条件をすべて満たした場合、BOT は自動的に VC に参加する。

* メッセージにリアクションが追加・削除された
* リアクション操作を行ったユーザー、またはメッセージ投稿者が VC に参加している

BOT は該当ユーザーが参加している VC に接続する。

### 4.2 接続方針

* BOT は **同一 guild 内で同時に 1 VC のみ** に接続する
* 既に接続済みの場合は再利用する
* reconnect はライブラリ標準の挙動に委ねる

---

## 5. 音声再生仕様

### 5.1 再生モデル

* guild 単位で再生キューを管理
* 再生は常に直列
* 再生中に追加された音声はキュー末尾に積まれる

### 5.2 再生トリガー

* Slash コマンド
* 絵文字リアクション（追加・削除）

---

## 6. 絵文字と音声のマッピング

### 6.1 設定ファイル

* `config.json` にて定義

```json
{
  "emoji_list": {
    "beer_mug": [
      {"source": "sounds/beer.wav", "freq": 100}
    ]
  },
  "server_emoji_list": {
    "atsumori": [
      {"source": "sounds/atsumori_std.wav", "freq": 80},
      {"source": "sounds/atsumori_long.wav", "freq": 20}
    ]
  }
}
```

### 6.2 振る舞い

* 1 絵文字に対して複数音源を定義可能
* `freq` により重み付きランダム選択を行う

---

## 7. 特殊音声「熱盛」

### 7.1 トリガー

* Slash コマンド `/atsumori`
* 絵文字 `♨️`
* サーバー絵文字 `atsumori`

### 7.2 再生内容

* 複数音声を連続再生
* 確率により以下のバリエーションを含む

  * 通常版
  * ロング版
  * 特殊版（低確率）

---

## 8. メッセージ監視機能

### 8.1 メッセージ送信時

* メッセージ内のサーバー絵文字を検出
* 対応する絵文字を BOT が自動リアクション

### 8.2 確率リアクション

* 一定確率で BOT が自動的に `atsumori` リアクションを付与する

---

## 9. 非機能要件

### 9.1 安定性

* VC 未接続状態での再生要求は無視する
* 例外発生時も BOT 全体が停止しないこと

### 9.2 状態管理

* 再生キューは guild 単位で管理する
* VC の接続状態とキュー状態は常に同期させる

### 9.3 責務分離

以下の責務を明確に分離すること：

* Voice 接続管理
* 再生キュー管理
* 絵文字 → 音声解決ロジック
* Discord イベントハンドリング

### 9.4 拡張性

* 新しい音声トリガーの追加が設定ファイルのみで可能であること
* 将来的な複数 VC 対応を妨げない構造であること

---

## 10. 想定スコープ外

* 大規模サーバーでの高負荷運用
* 同時多 VC 再生
* 音声ストリーミング用途

---

## 11. バージョン情報

* v1.0 : Slash コマンド対応・基本設計整理版

